Make команды
===

Загрузка служебных PHP скриптов:

- `bx-download-restore` — загрузка служебного PHP скрипта [restore.php](https://dev.1c-bitrix.ru/learning/course/index.php/lesson.php?COURSE_ID=48&LESSON_ID=6979)
- `bx-download-setup` — загрузка служебного PHP скрипта [bitrixsetup.php](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=32&LESSON_ID=4891)

Исправления в файловой структуре проекта:

- `bx-fix-chmod` — исправление прав доступа к файлам (755) и директориям (644) проекта
- `bx-fix-chmod` — назначение владельца файлов и директорий на текущего _(требуются права sudo)_

Загрузка `*.tar.gz` дистрибутивов:

- `bx-download-start` — загрузка исходного кода редакции "Старт"
- `bx-download-standard` — загрузка исходного кода редакции "Стандарт"
- `bx-download-small-business` — загрузка исходного кода редакции "Малый Бизнес"
- `bx-download-business` — загрузка исходного кода редакции "Бизнес"
- `bx-download-bitrix24-shop` —

## Composer

Список доступных команд-алиасов:

- `composer-download` — загрузка исполняемого файла `composer.phar` в корневую директорию проекта
- `composer-dump` — обновление списка автозагрузки классов из файла `composer.json`
- `composer-install` — установка зависимостей из файла `composer.json`
- `composer-update` — обновление списка зависимостей из файла `composer.json`

## NodeJS

> [!TIP]
> Рекомендуется предварительно установить [NVM](https://github.com/nvm-sh/nvm) и использовать в проекте одну версию NodeJS.
> Также напоминаю, что перед использованием инструмента необходимо перезапустить терминал.

Команды для работы с JS расширениями:

- `bx-install-extensions` — установка всех зависимостей JS расширений в директориях `/local/js/*`
- `bx-build-extensions` — сборка всех JS расширений в директориях `/local/js/*`

Команды для работы с шаблонами сайта:

- `bx-install-templates` — установка всех зависимостей у шаблонов в директории `/templates/js/*`
- `bx-build-extensions` — сборка всех шаблонов в директории `/templates/js/*`

## База данных

Резервное копирование MySQL осуществляется через [штатный клиент](https://dev.mysql.com/doc/refman/8.4/en/programs-client.html) с дополнительным gzip-сжатием.
Все файлы сохраняются в стандартной директории `/bitrix/backup` и совместимы со штатным функционалом 1C-Bitrix по распаковке резервных копий.

Команды для создания резервных копий:

- `mysql-dump-schema` — выгрузка структуры (без данных) всех таблиц в `*.sql.gz` файл.
- `mysql-dump-data` — выгрузка данных (без структуры) всех таблиц в `*.sql.gz` файл.
- `mysql-dump-full` — выгрузка всей БД со структурой и данными в `*.sql.gz` файл.

Команды для восстановления резервных копий:

- `mysql-restore-first` — восстановление самой старой резервной копии БД.
- `mysql-restore-last` — восстановление самой свежей резервной копии БД.

## Архивация (tar)

Архивация проекта осуществляется через утилиту `tar` с дополнительным gzip-сжатием.
Все файлы сохраняются в стандартной директории `/bitrix/backup` и совместимы со штатным функционалом 1C-Bitrix по распаковке резервных копий.

> [!TIP]
> В файле [.tarignore](../.tarignore) можно настроить список исключений (директории/файлы), которые не попадут в архив.
> Подробнее про эту опцию можно прочитать на [оф.сайте tar](https://www.gnu.org/software/tar/manual/html_section/exclude.html).

Команды для создания архивов:

- `pack-bitrix` — создание архива копии ядра продукта (папка `bitrix`)
- `pack-public` — создание архива публичной части (папка `public`)
- `pack-upload` — создание архива внутреннего хранилища (папка `upload`)
- `pack-full` — создание полной резервной копии проекта

Команды для распаковки архивов:

- `unpack-last` — распаковка последнего созданного архива (самый свежий)
- `unpack-first` — распаковка первого созданного архива (самый старый)

Примеры команд для ручной упаковки/распаковки архивов:

```shell
$ cd /path/to/www
$ tar -czf bitrix/backup/example.tar.gz --exclude-from=.tarignore .
$ tar -xzf bitrix/backup/example.tar.gz -C .
```
